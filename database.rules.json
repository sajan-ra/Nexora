
{
  "rules": {
    "settings": {
      "market": {
        ".read": "auth != null",
        ".write": "auth != null && auth.uid === 'wL3xCPtylQc5pxcuaFOWNdW62UW2'"
      }
    },
    "market": {
      "snapshot": {
        ".read": "auth != null",
        // Allow the serverless function to update the snapshot. 
        // In a production environment, you would use a Service Account via Firebase Admin SDK.
        // For this hybrid setup, we allow the specific path for the sync process.
        ".write": "auth != null && auth.uid === 'wL3xCPtylQc5pxcuaFOWNdW62UW2' || !data.exists() || (newData.hasChild('stocks') && auth == null)", 
        "stocks": {
          "$symbol": {
             ".read": "auth != null",
             ".write": "auth != null && auth.uid === 'wL3xCPtylQc5pxcuaFOWNdW62UW2' || auth == null"
          }
        }
      }
    }
  }
}
